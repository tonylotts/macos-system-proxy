#!/usr/bin/env bash

network_service=$1
secure=$2

function stat_param {
  secure=$1
  case $secure in
    true)
      echo '-getsecurewebproxy'
      ;;
    *)
      echo '-getwebproxy'
      ;;
  esac
}

function stat_command {
  param=$1
  echo "networksetup $param $network_service"
}

function enabled {
  _status=$(eval "$1")
  grep -e '^Enabled: Yes' <<< "$_status"
}

function server {
  _status=$1
  $_status | awk -F ': ' '/^Server/ {print $2}'
}

function port {
  _status=$1
  $_status | awk -F ': ' '/^Port/ {print $2}'
}

function url {
  _server=$1
  _port=$2
  echo "$_server:$_port"
}

param=$(stat_param "$secure")

proxy_status=$(stat_command "$param")

if [[ $(enabled "$proxy_status") ]]; then
  _s=$(server "$proxy_status")
  _p=$(port "$proxy_status")
  url "$_s" "$_p"
fi
